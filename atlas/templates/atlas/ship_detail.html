{% extends "base_generic.html" %}

{% block head %}
  <script src="https://api.tiles.mapbox.com/mapbox-gl-js/v0.50.0/mapbox-gl.js"></script>
  <link href="https://api.tiles.mapbox.com/mapbox-gl-js/v0.50.0/mapbox-gl.css" rel="stylesheet" />
{% endblock %}

{% block content %}
<h2>{{ ship.name }}</h2>

<table>
  {% if ship.imo %}
    <tr>
      <th scope="row">IMO Number</th>
      <td>{{ ship.imo }}</td>
    </tr>
  {% endif %}
  {% if ship.type %}
    <tr>
      <th scope="row">Type</th>
      <td>{{ ship.type }}</td>
    </tr>
  {% endif %}
  <tr>
    <th scope="row">Year Built</th>
    <td>{{ ship.year_built }}</td>
  </tr>
  {% if ship.builder %}
    <tr>
      <th scope="row">Builder</th>
      <td>{{ ship.builder }}</td>
    </tr>
  {% endif %}
  {% if ship.tonnage %}
    <tr>
      <th scope="row">Gross Tonnage</th>
      <td>{{ ship.tonnage }}</td>
    </tr>
  {% endif %}
  {% if ship.length %}
    <tr>
      <th scope="row">Length (m)</th>
      <td>{{ ship.length }}</td>
    </tr>
  {% endif %}
  {% if ship.beam %}
    <tr>
      <th scope="row">Beam (m)</th>
      <td>{{ ship.beam }}</td>
    </tr>
  {% endif %}
  {% if ship.city and ship.country %}
    <tr>
      <th scope="row">Location</th>
      <td>{{ ship.city }}, {{ ship.country }}</td>
    </tr>
  {% endif %}
  {% for registers in ship.registers.all %}
    <tr>
      <th scope="row">Historic Register</th>
      <td>{{ register }}</td>
    </tr>
  {% if not forloop.last %}
  {% endif %}
  {% endfor %}
  <tr>
    <th scope="row">Current Status</th>
    <td>{{ ship.status }}</td>
  </tr>
  {% for use in ship.uses.all %}
    <tr>
      <th scope="row">Current Use</th>
      <td>{{ use }}</td>
    </tr>
  {% if not forloop.last %}
  {% endif %}
  {% endfor %}
  {% if ship.flag %}
    <tr>
      <th scope="row">Flag</th>
      <td>{{ ship.flag }}</td>
    </tr>
  {% endif %}
  {% if ship.owner %}
    <tr>
      <th scope="row">Owner</th>
      <td>{{ ship.owner }}</td>
    </tr>
  {% endif %}
  {% if ship.website %}
    <tr>
      <th scope="row">Website</th>
      <td>{{ ship.website }}</td>
    </tr>
  {% endif %}
  {% if ship.former_names %}
    <tr>
      <th scope="row">Former Names</th>
      <td>{{ ship.former_names }}</td>
    </tr>
  {% endif %}
</table>

{% if ship.description %}
<p>{{ ship.description }}</p>
{% endif %}

{% if ship.status|stringformat:"s" != "Active" %}
<div id="map" style="height: 600px;"></div>
{% endif %}
{% endblock %}

{% block script %}
{% if ship.status|stringformat:"s" == "Active" %}
<script>
  fetch("https://apiv2.fleetmon.com/myfleet/{{ ship.fleetmon }}?apikey=4320bb316a86f03cccb627ce0f031905664d902c", {
    credentials: "include",
    headers: {
      "Accept": "application/json"
    },
  })
  .then(function(response) {
    return response.json();
  })
  .then(function(myJson) {
    console.log(myJson);
  });
</script>
{% endif %}

{% if ship.status|stringformat:"s" != "Active" %}
<script>
  mapboxgl.accessToken = "pk.eyJ1IjoiZG91Z25ld21hbiIsImEiOiJjam5vODkwaHQwNm1qM3BxbHV6YmlidWFoIn0.3rN2nNWL5-Ie_euOFrChbg";
  var map = new mapboxgl.Map({
      container: "map",
      center: [{{ ship.lon }}, {{ ship.lat }}],
      zoom: 12,
      style: "mapbox://styles/mapbox/satellite-streets-v10"
  });
  map.on("load", function () {
    var nav = new mapboxgl.NavigationControl();
    map.addControl(nav, "top-left");
    map.addLayer({
        "id": "points",
        "type": "symbol",
        "source": {
            "type": "geojson",
            "data": {
                "type": "FeatureCollection",
                "features": [{
                    "type": "Feature",
                    "geometry": {
                        "type": "Point",
                        "coordinates": [{{ ship.lon }}, {{ ship.lat }}]
                    },
                    "properties": {
                        "title": "{{ ship.name }}",
                        "icon": "harbor"
                    }
                }]
            }
        },
        "layout": {
            "icon-image": "{icon}-15",
            "text-field": "{title}",
            "text-font": ["DIN Offc Pro Medium", "Arial Unicode MS Bold"],
            "text-offset": [0, 0.6],
            "text-anchor": "top"
        },
        "paint": {
            "text-color": "#ffffff",
            "text-halo-color": "#000000",
            "text-halo-width": 1,
        }
    });
  });
</script>
{% endif %}
{% endblock %}
